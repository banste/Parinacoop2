<section class="dap-dialog-root" style="box-sizing:border-box; max-width:640px; width:100%; margin:0 auto; padding:1.25rem;">
  <div class="header flex items-center justify-between mb-4">
    <h2 class="title text-xl font-semibold">Detalle del Depósito a Plazo</h2>
    <button type="button" mat-button (click)="close()" class="close-btn">Cerrar</button>
  </div>

  <!-- Resumen / Estado -->
  <div class="summary rounded-xl p-4 mb-5">
    <div class="summary-top flex items-center justify-between">
      <div>
        <div class="muted">Depósito a Plazo</div>
        <div class="dap-id">{{ currentDap ? (currentDap.id | idPad) : '-' }}</div>
      </div>

      <div class="text-right">
        <div class="muted">Estado</div>
        <div
          class="status text-sm font-semibold"
          [ngClass]="{
            'status-active': statusKey === 'active' || statusKey === 'paid',
            'status-pending': statusKey === 'pending' || statusKey === 'expired-pending',
            'status-expired': statusKey === 'expired',
            'status-cancelled': statusKey === 'cancelled'
          }"
        >
          {{ statusKey | dapStatus }}
        </div>
      </div>
    </div>
  </div>

  <!-- Datos principales -->
  <div class="card rounded-lg p-4 bg-white mb-4">
    <div class="mb-3 text-sm font-medium">Datos del depósito</div>
    <div class="grid grid-cols-2 gap-x-6 gap-y-2 items-start">
      <div class="muted">Tipo</div>
      <div class="value">{{ currentDap.type | dapType }}</div>

      <div class="muted">Moneda</div>
      <div class="value">{{ currentDap.currencyType ?? '-' }}</div>

      <div class="muted">Plazo (días)</div>
      <div class="value">{{ currentDap && currentDap.days != null ? currentDap.days.toString() : '-' }}</div>

      <div class="muted">Fecha ingreso</div>
      <div class="value">{{ currentDap && currentDap.initialDate ? (currentDap.initialDate | date:'dd-MM-yyyy') : '-' }}</div>

      <div class="muted">Vencimiento</div>
      <div class="value">{{ currentDap && currentDap.dueDate ? (currentDap.dueDate | date:'dd-MM-yyyy') : '-' }}</div>

      <div class="muted">Monto capital</div>
      <div class="value">{{ currentDap && currentDap.initialAmount != null ? (currentDap.initialAmount | currency:'CLP':'symbol':'1.0-0') : '-' }}</div>

      <div class="muted">Monto a recibir</div>
      <div class="value">{{ currentDap && currentDap.finalAmount != null ? (currentDap.finalAmount | currency:'CLP':'symbol':'1.0-0') : '-' }}</div>

      <div class="muted">Intereses</div>
      <div class="value">
        {{ displayInterest != null ? (displayInterest | percent:'1.2-2') : '-' }}
      </div>

      <!-- Nueva fila: ID interna (solo si existe) -->
      <div class="muted">ID interna</div>
      <div class="value">{{ currentDap.internalId ?? '-' }}</div>
    </div>
  </div>

  <!-- Acciones: descargar solicitud / instructivo (ocultas a admin) -->
  <div class="actions flex gap-2 justify-end">
    <button
      *ngIf="!isAdmin"
      mat-stroked-button
      color="primary"
      (click)="descargarSolicitudPdf()"
      [disabled]="isDownloadingSolicitud || !canDownloadSolicitud"
      class="btn btn-primary"
      [attr.title]="canDownloadSolicitud ? 'Descargar solicitud' : 'Disponible solo para DAPs en estado ACTIVO'"
    >
      {{ isDownloadingSolicitud ? 'Descargando...' : 'Descargar solicitud' }}
    </button>

    <button
      *ngIf="!isAdmin"
      mat-stroked-button
      color="primary"
      (click)="descargarInstructivoPdf()"
      [disabled]="isDownloadingInstructivo"
      class="btn btn-secondary"
      title="Ver / descargar instructivo"
    >
      {{ isDownloadingInstructivo ? 'Abriendo...' : 'Instructivo' }}
    </button>
  </div>
</section>